<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Images Out of DICOM Format Quickly • divest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Get Images Out of DICOM Format Quickly">
<meta property="og:description" content="Provides tools to sort DICOM-format medical image files,
        and convert them to NIfTI-1 format.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">divest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonclayden/divest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="an-r-interface-to-dcm2niix" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#an-r-interface-to-dcm2niix" class="anchor" aria-hidden="true"></a>An R interface to dcm2niix</h1></div>
<p><a href="https://www.dicomstandard.org" class="external-link">DICOM</a>, for Digital Imaging and Communications in Medicine, is the highly complex standard by which medical imaging devices such as magnetic resonance (MR) and computed tomography (CT) scanners communicate. Importantly for medical imaging research, DICOM defines the format in which images are first created when a subject is scanned. The complexity of DICOM, and the high degree of variation in how it is implemented by hardware vendors, makes it difficult and error-prone to work with. The <a href="https://nifti.nimh.nih.gov" class="external-link">NIfTI-1 file format</a> has emerged as a simpler, more interoperable standard for medical images, and generally researchers want to convert their images to this format <a href="https://doi.org/10.1016/j.jneumeth.2016.03.001" class="external-link">as soon as possible</a>.</p>
<blockquote>
<p><em>divest</em>, <strong>v.</strong>: rid oneself of something that one no longer wants or requires</p>
</blockquote>
<p>The <code>divest</code> package is an alternative interface to <a href="http://www.mccauslandcenter.sc.edu/crnl/" class="external-link">Chris Rorden’s</a> excellent <a href="https://github.com/rordenlab/dcm2niix" class="external-link"><code>dcm2niix</code> DICOM-to-NIfTI conversion tool</a>. Code has been contributed to <code>dcm2niix</code> to support an in-memory interface that links that tool’s speed and reliability to the R-native NIfTI tools provided by the <a href="https://github.com/jonclayden/RNifti" class="external-link"><code>RNifti</code> package</a>.</p>
<p>The package is <a href="https://cran.r-project.org/package=divest" class="external-link">on CRAN</a>, and the latest development version of the package can always be installed from GitHub using the <code>remotes</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"jonclayden/divest"</span><span class="op">)</span></code></pre></div>
<p><strong>Please note that, like <code>dcm2niix</code>, the <code>divest</code> package is to be used for research purposes only, and is not a clinical tool. It comes with no warranty.</strong></p>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor" aria-hidden="true"></a>Usage</h2>
<p>The package’s key function is <code>readDicom</code>, which scans a directory containing DICOM files, stacks related data into merged 3D or 4D images where appropriate, and returns a list of <code>niftiImage</code> objects. For example,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonclayden/divest" class="external-link">divest</a></span><span class="op">)</span>
<span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"raw"</span>, package<span class="op">=</span><span class="st">"divest"</span><span class="op">)</span>
<span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/readDicom.html">readDicom</a></span><span class="op">(</span><span class="va">path</span>, interactive<span class="op">=</span><span class="cn">FALSE</span>, verbosity<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="co">## [dcm2niix WARNING] Unable to determine manufacturer (0008,0070), so conversion is not tuned for vendor.</span>
<span class="co">## [dcm2niix WARNING] All images appear to be a single slice - please check slice/vector orientation</span>
<span class="co">## [dcm2niix WARNING] Check that 2D images are not mirrored.</span>
<span class="co">## [dcm2niix WARNING] Unable to determine manufacturer (0008,0070), so conversion is not tuned for vendor.</span></code></pre></div>
<p>The conversion is interactive by default, prompting the user to select which series to convert, but here we simply convert everything non-interactively. The minimal test dataset provided with the package contains two images from each of two acquisitions. (It is incomplete, hence the warnings.) We can see the basic properties of a converted composite image by printing it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract the image with a fourth dimension</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">images</span>, <span class="fu">RNifti</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/RNifti/man/ndim.html" class="external-link">ndim</a></span><span class="op">)</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">images</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
<span class="co">## Internal image: "T0_N_S8"</span>
<span class="co">## - 96 x 96 x 1 x 2 voxels</span>
<span class="co">## - 2.5 x 2.5 x 5 mm x 4.1 s per voxel</span></code></pre></div>
<p>Additional properties of the scanning sequence, such as the magnetic field strength used, are stored in attributes if they can be deduced from the DICOM files.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">images</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">## $imagedim</span>
<span class="co">## [1] 96 96  1  2</span>
<span class="co">## </span>
<span class="co">## $pixdim</span>
<span class="co">## [1] 2.5 2.5 5.0 4.1</span>
<span class="co">## </span>
<span class="co">## $pixunits</span>
<span class="co">## [1] "mm" "s" </span>
<span class="co">## </span>
<span class="co">## $.nifti_image_ptr</span>
<span class="co">## &lt;pointer: 0x7fc594ce4f30&gt;</span>
<span class="co">## </span>
<span class="co">## $.nifti_image_ver</span>
<span class="co">## [1] 1</span>
<span class="co">## </span>
<span class="co">## $class</span>
<span class="co">## [1] "internalImage" "niftiImage"   </span>
<span class="co">## </span>
<span class="co">## $modality</span>
<span class="co">## [1] "MR"</span>
<span class="co">## </span>
<span class="co">## $imageType</span>
<span class="co">## [1] "ORIGINAL_PRIMARY_M_ND_NORM"</span>
<span class="co">## </span>
<span class="co">## $seriesNumber</span>
<span class="co">## [1] 8</span>
<span class="co">## </span>
<span class="co">## $seriesDescription</span>
<span class="co">## [1] "DTIb3000s5"</span>
<span class="co">## </span>
<span class="co">## $sequenceName</span>
<span class="co">## [1] "ep_b2000#16"</span>
<span class="co">## </span>
<span class="co">## $protocolName</span>
<span class="co">## [1] "DTIb3000s5"</span>
<span class="co">## </span>
<span class="co">## $fieldStrength</span>
<span class="co">## [1] 1.494</span>
<span class="co">## </span>
<span class="co">## $flipAngle</span>
<span class="co">## [1] 90</span>
<span class="co">## </span>
<span class="co">## $echoTime</span>
<span class="co">## [1] 112</span>
<span class="co">## </span>
<span class="co">## $repetitionTime</span>
<span class="co">## [1] 4100</span>
<span class="co">## </span>
<span class="co">## $sliceThickness</span>
<span class="co">## [1] 5</span>
<span class="co">## </span>
<span class="co">## $sliceSpacing</span>
<span class="co">## [1] 5</span>
<span class="co">## </span>
<span class="co">## $phaseEncodingSteps</span>
<span class="co">## [1] 72</span>
<span class="co">## </span>
<span class="co">## $phaseEncodingLines</span>
<span class="co">## [1] 96</span>
<span class="co">## </span>
<span class="co">## $pixelBandwidth</span>
<span class="co">## [1] 900</span>
<span class="co">## </span>
<span class="co">## $phaseEncodingDirection</span>
<span class="co">## [1] "j"</span>
<span class="co">## </span>
<span class="co">## $phaseEncodingSign</span>
<span class="co">## [1] -1</span></code></pre></div>
<p>If desired, functions from the <code>RNifti</code> package can be used to inspect and modify the details of the converted NIfTI image, or to write it to file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonclayden/RNifti" class="external-link">RNifti</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/RNifti/man/niftiHeader.html" class="external-link">niftiHeader</a></span><span class="op">(</span><span class="va">images</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">## NIfTI-1 header</span>
<span class="co">##     sizeof_hdr: 348</span>
<span class="co">##       dim_info: 57</span>
<span class="co">##            dim: 4  96  96  1  2  1  1  1</span>
<span class="co">##      intent_p1: 0</span>
<span class="co">##      intent_p2: 0</span>
<span class="co">##      intent_p3: 0</span>
<span class="co">##    intent_code: 0 (Unknown)</span>
<span class="co">##       datatype: 4 (INT16)</span>
<span class="co">##         bitpix: 16</span>
<span class="co">##    slice_start: 0</span>
<span class="co">##         pixdim: -1.0  2.5  2.5  5.0  4.1  0.0  0.0  0.0</span>
<span class="co">##     vox_offset: 352</span>
<span class="co">##      scl_slope: 1</span>
<span class="co">##      scl_inter: 0</span>
<span class="co">##      slice_end: 0</span>
<span class="co">##     slice_code: 0 (Unknown)</span>
<span class="co">##     xyzt_units: 10</span>
<span class="co">##        cal_max: 0</span>
<span class="co">##        cal_min: 0</span>
<span class="co">## slice_duration: 0</span>
<span class="co">##        toffset: 0</span>
<span class="co">##        descrip: TE=1.1e+02;Time=0.000;phase=1</span>
<span class="co">##       aux_file: </span>
<span class="co">##     qform_code: 1 (Scanner Anat)</span>
<span class="co">##     sform_code: 1 (Scanner Anat)</span>
<span class="co">##      quatern_b: 0</span>
<span class="co">##      quatern_c: 1</span>
<span class="co">##      quatern_d: 0</span>
<span class="co">##      qoffset_x: 122.0339</span>
<span class="co">##      qoffset_y: -101.2288</span>
<span class="co">##      qoffset_z: -55.42373</span>
<span class="co">##         srow_x: -2.5000  0.0000  0.0000  122.0339</span>
<span class="co">##         srow_y: 0.0000  2.5000  0.0000  -101.2288</span>
<span class="co">##         srow_z: 0.00000  0.00000  5.00000  -55.42373</span>
<span class="co">##    intent_name: </span>
<span class="co">##          magic: n+1</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RNifti/man/writeNifti.html" class="external-link">writeNifti</a></span><span class="op">(</span><span class="va">images</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"stack"</span><span class="op">)</span></code></pre></div>
<p>It is also possible to obtain information about the available DICOM series without actually performing the conversion. The <code>scanDicom</code> function returns a data frame containing certain information about each series.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="reference/readDicom.html">scanDicom</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [dcm2niix info] Found 4 DICOM file(s)</span>
<span class="co">##  [1] "label"             "rootPath"          "files"            </span>
<span class="co">##  [4] "seriesNumber"      "seriesDescription" "patientName"      </span>
<span class="co">##  [7] "studyDate"         "echoTime"          "repetitionTime"   </span>
<span class="co">## [10] "echoNumber"        "phase"             "diffusion"</span></code></pre></div>
<p>Elements of this data frame which can’t be determined from the DICOM metadata, for example due to anonymisation, will take the conventional <code>NA</code> value to indicate missing data.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=divest">https://​cloud.r-project.org/​package=divest</a>
</li>
<li>Browse source code at <br><a href="https://github.com/jonclayden/divest/">https://​github.com/​jonclayden/​divest/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/jonclayden/divest/issues">https://​github.com/​jonclayden/​divest/​issues</a>
</li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/BSD-3-Clause">BSD_3_clause</a> + file <a href="LICENSE-text.html">LICENCE</a>
</li>
</ul>
</div>


<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jon Clayden <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-6608-0619" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Chris Rorden <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More on authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=divest" class="external-link"><img src="http://www.r-pkg.org/badges/version/divest" alt="CRAN version"></a></li>
<li><a href="https://travis-ci.org/jonclayden/divest" class="external-link"><img src="https://travis-ci.org/jonclayden/divest.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/jonclayden/divest" class="external-link"><img src="https://ci.appveyor.com/api/projects/status/lc8v02uc1ywkskrc?svg=true" alt="Build status"></a></li>
<li><a href="https://coveralls.io/github/jonclayden/divest?branch=master" class="external-link"><img src="https://coveralls.io/repos/github/jonclayden/divest/badge.svg?branch=master" alt="Coverage Status"></a></li>
<li><a href="https://tinyverse.netlify.app" class="external-link"><img src="https://tinyverse.netlify.com/badge/divest" alt="Dependencies"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Jon Clayden, Chris Rorden.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
